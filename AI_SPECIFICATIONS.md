# AI仕様書

## スキルレベル

AIプレイヤーには3つのスキルレベルが実装されています：

1. 初級 (beginner)
   - 予測精度: 30%
   - 選択プール: 上位50%の候補から選択

2. 中級 (intermediate)
   - 予測精度: 60%
   - 選択プール: 上位20%の候補から選択

3. 上級 (expert)
   - 予測精度: 95%
   - 選択プール: 上位10%の候補から選択
   - 確率が極端に低い選択肢（最高確率の1%未満）は除外

## 性格タイプ

AIプレイヤーには3つの性格タイプが実装されています：

1. 積極的 (aggressive)
   - 基本継続確率: 80%
   - 特徴: 積極的に予想を続ける傾向が強い

2. バランス型 (balanced)
   - 基本継続確率: 50%
   - 特徴: バランスの取れた判断を行う

3. 慎重 (cautious)
   - 基本継続確率: 20%
   - 特徴: リスクを避け、早めに手番を終える傾向が強い

## 状況に応じた確率調整

以下の状況で基本継続確率が調整されます：

1. 残りカードが少ない場合（3枚以下）
   - 継続確率 × 1.2

2. 自分の手札の状況
   - 残り3枚以下: 継続確率 × 1.2
   - それ以外: 継続確率 × 0.8

3. 最終的な確率は0%～90%の範囲に制限

## 予測ロジック

1. カード位置による制約
   - 昇順ルールに基づく範囲制限
   - 既に公開されているカードの考慮

2. 確率計算要素
   - カードの連続性
   - 分配確率
   - スキルレベルによる調整
   - 過去の予想履歴の考慮

3. 選択方法
   - スキルレベルに応じた選択プールの設定
   - 確率に基づく重み付き選択

## 1. コンピューターAIの基本設計

### 1.1 性格タイプシステム

各コンピュータープレイヤーには、以下のように固定の性格タイプが割り当てられています：

- Computer 1: aggressive（積極的）
  - 特徴: リスクを取る傾向が強く、続行判断の確率が20%上昇
  - 予想を続ける可能性が高い

- Computer 2: cautious（慎重）
  - 特徴: より安全な選択を好み、続行判断の確率が20%減少
  - 確実な状況でのみ予想を続ける

- Computer 3: balanced（バランス型）
  - 特徴: 状況に応じて柔軟に対応
  - 基本確率をそのまま使用

これらの性格タイプは固定であり、ランダムではありません。プレイヤーが各コンピューターの特徴を学習し、戦略を立てられるようにするためです。

### 1.2 難易度システムの詳細

難易度設定は「二段階の精度調整」によって実現されています：

#### 1.2.1 基本精度（確率計算時の精度係数）

各難易度レベルには以下の精度係数が設定されています：

- 初級（Beginner）: 30%
  - 計算された確率に0.3を乗算
  - 例: 確率1.0のカード → 0.3の最終確率

- 中級（Intermediate）: 60%
  - 計算された確率に0.6を乗算
  - 例: 確率1.0のカード → 0.6の最終確率

- 上級（Expert）: 90%
  - 計算された確率に0.9を乗算
  - 例: 確率1.0のカード → 0.9の最終確率

#### 1.2.2 選択範囲の制限

確率計算後、選択できるカードの範囲が難易度によって制限されます：

- 初級: 確率上位50%のカードから選択
  - より広い選択範囲
  - 予測の不確実性が高い

- 中級: 確率上位30%のカードから選択
  - バランスの取れた選択範囲
  - 適度な予測精度

- 上級: 確率上位10%のカードから選択
  - 非常に狭い選択範囲
  - 高い予測精度

この二段階の調整により、以下のような特徴的な振る舞いが実現されています：
- 初級: 「不正確な計算」から「幅広い選択」
- 中級: 「やや正確な計算」から「中程度の選択範囲」
- 上級: 「正確な計算」から「狭い選択範囲」

## 2. 確率計算システムの詳細

### 2.1 基本確率の計算要素

1. **カード位置による基本確率**
   - カードの昇順配置を利用
   - 位置に基づく数字範囲の推定
   - 確率の初期値を1.0として開始

2. **既知情報による調整**
   - 公開済みカードの影響
   - 同じスートの残り枚数
   - 同じ数字の残り枚数

3. **履歴情報の活用**
   - 過去の予想結果の分析
   - 不正解だったカードの除外
   - スートの傾向の反映

### 2.2 確率の補正要素

1. **スキルレベルによる補正**
   - 基本精度係数の適用
   - 選択範囲の制限

2. **位置関係による補正**
   - 前後のカードとの整合性
   - 数字の連続性の考慮

3. **履歴による補正**
   - 過去の正解パターンの重み付け
   - スート傾向の反映

## 3. 続行判断システムの詳細

### 3.1 基本確率の決定

1. **スキルレベルベース**
   - 初級: 30%の基本確率
   - 中級: 60%の基本確率
   - 上級: 90%の基本確率

2. **性格タイプによる調整**
   - 積極的: +20%
   - 慎重: -20%
   - バランス: 変更なし

### 3.2 状況による確率調整

1. **残りカード枚数による調整**
   - 相手の残り3枚以下: +20%
   - 自分の残り3枚以下: +20%
   - 自分の残りが多い: -20%

2. **最終確率の制限**
   - 最小値: 0%
   - 最大値: 90%

## 4. 実装の技術的詳細

### 4.1 確率計算の実装

```typescript
// 確率計算の基本構造
interface CardProbability {
  suit: Card['suit'];
  number: number;
  probability: number;
}

// スキルレベルに基づく確率調整係数
const SKILL_LEVEL_FACTORS = {
  beginner: 0.3,    // 30%の精度
  intermediate: 0.6, // 60%の精度
  expert: 0.9,      // 90%の精度
};
```

### 4.2 予想選択の実装

```typescript
// 選択範囲の決定
const getSelectionPool = (probabilities: CardProbability[], skillLevel: SkillLevel) => {
  const sorted = [...probabilities].sort((a, b) => b.probability - a.probability);
  const poolSize = {
    beginner: 0.5,     // 上位50%
    intermediate: 0.3,  // 上位30%
    expert: 0.1        // 上位10%
  }[skillLevel];
  
  return sorted.slice(0, Math.ceil(sorted.length * poolSize));
};
``` 